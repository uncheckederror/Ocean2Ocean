@model Ocean2Ocean.DataAccess.Journey
@{
    ViewData["Title"] = "Home Page";
}

<script src="https://api.mapbox.com/mapbox-gl-js/v1.10.1/mapbox-gl.js"></script>
<link href="https://api.mapbox.com/mapbox-gl-js/v1.10.1/mapbox-gl.css" rel="stylesheet" />
<script src='https://unpkg.com/@@turf/turf/turf.min.js'></script>

<style>
    #map {
        position: absolute;
        top: 0;
        bottom: 0;
        width: 100%;
    }

    .legend {
        background-color: white;
        border-radius: 5px;
    }
</style>
<div id="map"></div>
<link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />
<div class="container-fluid">
    <div class="row">
        <div class="col-auto">

        </div>
        <div class="col-auto legend mt-3">
            <h1 class="display-4 pt-3">
                🏃 Add Your Steps
            </h1>
            <p id="stats" class="card-subtitle text-center pb-4"></p>
            <div class="progress">
                <div class="progress-bar progress-bar-striped bg-success" role="progressbar" id="progressbar" aria-valuenow="42" aria-valuemin="0" aria-valuemax="100"></div>
            </div>
            <p id="progresslabel" class="text-center"></p>
            <form asp-action="AddSteps">
                <div class="form-group">
                    <label for="exampleInputEmail1">Work Email Address</label>
                    <input type="email" name="email" class="form-control" id="exampleInputEmail1" aria-describedby="emailHelp" placeholder="Enter email" value="@Model?.Step?.Email">
                    <small id="emailHelp" class="form-text text-muted">We'll never share your email with anyone else.</small>
                </div>
                <div class="form-group">
                    <label for="exampleInputPassword1">Steps Taken Today</label>
                    <input type="number" name="steps" class="form-control" id="exampleInputPassword1" placeholder="1337" value="@Model?.Step?.Steps">
                    <small id="emailHelp" class="form-text text-muted">1 Mile is about 2000 steps.</small>
                    <input type="number" id="stepsTaken" name="stepsTaken" hidden />
                    <input type="number" id="stepsInRoute" name="stepsInRoute" hidden />
                </div>
                <div class="form-group">
                    <button type="submit" class="btn btn-primary btn-lg" asp-action="AddSteps">🚀 Submit</button>
                    <a class="btn btn-info btn-lg" href="https://github.com/uncheckederror/Ocean2Ocean" target="_blank">👓 Github</a>
                </div>
            </form>
        </div>
    </div>
</div>
<script>

    // Source: http://www.mredkj.com/javascript/numberFormat.html
    function addCommas(nStr) {
        nStr += '';
        x = nStr.split('.');
        x1 = x[0];
        x2 = x.length > 1 ? '.' + x[1] : '';
        var rgx = /(\d+)(\d{3})/;
        while (rgx.test(x1)) {
            x1 = x1.replace(rgx, '$1' + ',' + '$2');
        }
        return x1 + x2;
    }

    mapboxgl.accessToken = '@Model?.MapboxAccessToken';
    var map = new mapboxgl.Map({
        container: 'map',
        style: 'mapbox://styles/mapbox/streets-v11',
        center: [-97, 50],
        zoom: 4
    });

    var route =
        [
            [
                -122.32822000980377,
                47.602632914527724
            ],
            [
                -122.32767283916473,
                47.60198545716705
            ],
            [
                -122.3276674747467,
                47.60088584641723
            ],
            [
                -122.32901930809022,
                47.60088584641723
            ],
            [
                -122.32900857925414,
                47.60180098460867
            ],
            [
                -122.33029067516327,
                47.60324419373195
            ],
            [
                -122.33028799295425,
                47.60324961925505
            ],
            [
                -122.33091562986374,
                47.60395312398166
            ],
            [
                -122.32870280742645,
                47.60489352683453
            ],
            [
                -122.32692182064055,
                47.60287525684194
            ],
            [
                -122.3246258497238,
                47.6012511801841
            ],
            [
                -122.32160568237306,
                47.599102546956125
            ],
            [
                -122.32031822204591,
                47.59678742249891
            ],
            [
                -122.3206615447998,
                47.593893372872294
            ],
            [
                -122.3166275024414,
                47.594819486167566
            ],
            [
                -122.3129367828369,
                47.59418278503775
            ],
            [
                -122.3103618621826,
                47.59082550551166
            ],
            [
                -122.30615615844727,
                47.59007298227701
            ],
            [
                -122.28701591491699,
                47.59042030203756
            ],
            [
                -122.25276947021484,
                47.58943622339631
            ],
            [
                -122.24727630615236,
                47.59175167310035
            ],
            [
                -122.24367141723633,
                47.59221475074825
            ],
            [
                -122.23663330078124,
                47.58960988567753
            ],
            [
                -122.22084045410155,
                47.58301031389572
            ],
            [
                -122.21560478210448,
                47.5798839105199
            ],
            [
                -122.20539093017578,
                47.57785743823819
            ],
            [
                -122.19500541687012,
                47.58017340015733
            ],
            [
                -122.18899726867676,
                47.579304926442894
            ],
            [
                -122.1720027923584,
                47.5805786829606
            ],
            [
                -122.13372230529785,
                47.57837853860192
            ],
            [
                -122.10411071777344,
                47.568187190520135
            ],
            [
                -122.05158233642578,
                47.5459446373605
            ],
            [
                -122.0364761352539,
                47.54223662718361
            ],
            [
                -122.02823638916014,
                47.533197253523554
            ],
            [
                -122.02136993408203,
                47.53203824675999
            ],
            [
                -122.01107025146483,
                47.537601245618134
            ],
            [
                -121.99562072753906,
                47.5325018525392
            ],
            [
                -121.981201171875,
                47.53087921438143
            ],
            [
                -121.96884155273436,
                47.5366741201253
            ],
            [
                -121.95236206054688,
                47.5325018525392
            ],
            [
                -121.94000244140624,
                47.529488341715265
            ],
            [
                -121.9317626953125,
                47.52044677028523
            ],
            [
                -121.90052032470702,
                47.50699744840906
            ],
            [
                -121.83872222900389,
                47.514186307885794
            ],
            [
                -121.7789840698242,
                47.473359062708376
            ],
            [
                -121.73847198486328,
                47.47359112535713
            ],
            [
                -121.7010498046875,
                47.4596655525415
            ],
            [
                -121.69349670410158,
                47.44527191807436
            ],
            [
                -121.65916442871092,
                47.441556792248534
            ],
            [
                -121.63169860839845,
                47.4292485639398
            ],
            [
                -121.5963363647461,
                47.42437092240519
            ],
            [
                -121.56681060791016,
                47.404158735124305
            ],
            [
                -121.53728485107422,
                47.39602520707679
            ],
            [
                -121.50192260742186,
                47.39718721653071
            ],
            [
                -121.46724700927733,
                47.3955603961201
            ],
            [
                -121.41883850097656,
                47.42855178567924
            ],
            [
                -121.40853881835936,
                47.42506775601176
            ],
            [
                -121.40785217285155,
                47.41600819961789
            ],
            [
                -121.40270233154295,
                47.40276450520579
            ],
            [
                -121.37969970703124,
                47.38742554067244
            ],
            [
                -121.36287689208984,
                47.342545069660225
            ],
            [
                -121.33060455322266,
                47.32555960153742
            ],
            [
                -121.27155303955078,
                47.27270686584952
            ],
            [
                -121.2234878540039,
                47.26571797013935
            ],
            [
                -121.15242004394531,
                47.22213304801515
            ],
            [
                -121.04907989501953,
                47.19461180894462
            ],
            [
                -121.04255676269531,
                47.184812667729325
            ],
            [
                -120.98831176757811,
                47.18597932702905
            ],
            [
                -120.95878601074217,
                47.19624482325592
            ],
            [
                -120.90591430664062,
                47.18551266638603
            ],
            [
                -120.87947845458984,
                47.16684287656919
            ],
            [
                -120.82351684570312,
                47.15540438868654
            ],
            [
                -120.79776763916017,
                47.118037074007965
            ],
            [
                -120.76515197753906,
                47.1075227853425
            ],
            [
                -120.73631286621094,
                47.083448927858754
            ],
            [
                -120.62919616699217,
                47.03948023197402
            ],
            [
                -120.55572509765626,
                46.976504510552
            ],
            [
                -120.50971984863283,
                46.970413702680084
            ],
            [
                -119.95971679687499,
                46.93526088057719
            ],
            [
                -119.9542236328125,
                47.017716353979225
            ],
            [
                -119.83337402343749,
                47.111261437080344
            ],
            [
                -118.7017822265625,
                47.08882558740757
            ],
            [
                -118.37219238281249,
                47.12621341795227
            ],
            [
                -117.41638183593749,
                47.657987988142274
            ],
            [
                -117.12387084960936,
                47.66723703450518
            ],
            [
                -116.98654174804688,
                47.71530566159559
            ],
            [
                -116.78054809570311,
                47.69774726151598
            ],
            [
                -116.70227050781249,
                47.63300737749619
            ],
            [
                -116.52786254882811,
                47.623752267682875
            ],
            [
                -116.44821166992188,
                47.57652571374621
            ],
            [
                -116.34246826171874,
                47.54779854409145
            ],
            [
                -116.1968994140625,
                47.54687159892238
            ],
            [
                -116.13372802734375,
                47.54779854409145
            ],
            [
                -116.04034423828125,
                47.52740196355499
            ],
            [
                -115.91537475585938,
                47.47451936570433
            ],
            [
                -115.697021484375,
                47.45873704984453
            ],
            [
                -115.67642211914062,
                47.436448065837205
            ],
            [
                -115.41549682617188,
                47.3955603961201
            ],
            [
                -115.18753051757811,
                47.300653220457775
            ],
            [
                -115.10513305664062,
                47.301584511330795
            ],
            [
                -115.03921508789062,
                47.2400841234947
            ],
            [
                -114.87991333007814,
                47.186912636007655
            ],
            [
                -114.78378295898436,
                47.12434465012191
            ],
            [
                -114.73434448242186,
                47.009289244518946
            ],
            [
                -114.66567993164062,
                47.01958886438217
            ],
            [
                -114.56268310546874,
                47.00647991252098
            ],
            [
                -114.5269775390625,
                47.02333368818491
            ],
            [
                -114.46105957031249,
                46.99992422991225
            ],
            [
                -114.42123413085938,
                46.99617776437492
            ],
            [
                -114.3402099609375,
                47.034566583590426
            ],
            [
                -114.02297973632812,
                46.9061837801476
            ],
            [
                -113.961181640625,
                46.86394700508323
            ],
            [
                -113.88702392578125,
                46.87709089874478
            ],
            [
                -113.71810913085938,
                46.78407569031799
            ],
            [
                -113.6865234375,
                46.721976114280686
            ],
            [
                -113.57391357421875,
                46.7276244872016
            ],
            [
                -113.49014282226562,
                46.69843486113957
            ],
            [
                -113.34320068359375,
                46.70408569832252
            ],
            [
                -113.29376220703125,
                46.721976114280686
            ],
            [
                -113.04244995117186,
                46.612657984230204
            ],
            [
                -112.91473388671875,
                46.59378768493023
            ],
            [
                -112.73345947265625,
                46.492719928122746
            ],
            [
                -112.71560668945311,
                46.395252655951154
            ],
            [
                -112.80349731445312,
                46.116085686143805
            ],
            [
                -112.7801513671875,
                46.07132518308108
            ],
            [
                -112.70187377929688,
                46.00554713642256
            ],
            [
                -112.54531860351562,
                46.00554713642256
            ],
            [
                -112.4725341796875,
                45.98169518512228
            ],
            [
                -112.445068359375,
                45.916765867649005
            ],
            [
                -111.9451904296875,
                45.874712248904764
            ],
            [
                -111.5167236328125,
                45.916765867649005
            ],
            [
                -110.91796875,
                45.64860838388028
            ],
            [
                -110.8245849609375,
                45.66780526567164
            ],
            [
                -110.55541992187499,
                45.64860838388028
            ],
            [
                -110.4290771484375,
                45.729191061299915
            ],
            [
                -110.247802734375,
                45.70234306798271
            ],
            [
                -109.8907470703125,
                45.832626782661535
            ],
            [
                -109.0887451171875,
                45.606352077118316
            ],
            [
                -108.3856201171875,
                45.832626782661535
            ],
            [
                -107.5726318359375,
                45.74069339553309
            ],
            [
                -107.4462890625,
                45.6101948758674
            ],
            [
                -107.3089599609375,
                45.00753503123719
            ],
            [
                -106.94091796875,
                44.80522439622254
            ],
            [
                -106.6937255859375,
                44.35920579433503
            ],
            [
                -106.270751953125,
                44.174324837518895
            ],
            [
                -105.5401611328125,
                44.276671273775186
            ],
            [
                -104.578857421875,
                44.3002644115815
            ],
            [
                -104.17236328125,
                44.50825885600572
            ],
            [
                -103.85925292968749,
                44.50825885600572
            ],
            [
                -103.4912109375,
                44.41416430998939
            ],
            [
                -103.238525390625,
                44.08363928284644
            ],
            [
                -102.6837158203125,
                44.1151978766043
            ],
            [
                -102.3486328125,
                44.05601169578525
            ],
            [
                -101.8267822265625,
                43.830564195198264
            ],
            [
                -100.9259033203125,
                43.9058083561574
            ],
            [
                -99.635009765625,
                43.878097874251736
            ],
            [
                -98.426513671875,
                43.70362249839005
            ],
            [
                -97.8057861328125,
                43.68773584519811
            ],
            [
                -97.09167480468749,
                43.65594991256823
            ],
            [
                -97.0037841796875,
                43.628123412124616
            ],
            [
                -96.3226318359375,
                43.60823944964323
            ],
            [
                -96.17431640625,
                43.636075155965784
            ],
            [
                -94.9822998046875,
                43.636075155965784
            ],
            [
                -94.5648193359375,
                43.683763524273346
            ],
            [
                -93.284912109375,
                43.67979094030124
            ],
            [
                -92.74658203125,
                43.67979094030124
            ],
            [
                -92.3236083984375,
                43.96119063892024
            ],
            [
                -91.6534423828125,
                43.949327348785225
            ],
            [
                -91.1480712890625,
                43.874138181474734
            ],
            [
                -90.4119873046875,
                43.98491011404692
            ],
            [
                -90.11810302734375,
                43.874138181474734
            ],
            [
                -89.813232421875,
                43.65197548731187
            ],
            [
                -89.79400634765624,
                43.55850077671243
            ],
            [
                -89.48638916015625,
                43.50274467820439
            ],
            [
                -89.44244384765625,
                43.30919109985686
            ],
            [
                -89.26666259765625,
                43.038783344984836
            ],
            [
                -89.0936279296875,
                42.97049193148623
            ],
            [
                -88.98651123046875,
                42.72280375732727
            ],
            [
                -88.96728515624999,
                42.24478535602799
            ],
            [
                -88.76953125,
                42.22648356137063
            ],
            [
                -88.253173828125,
                42.05541092308216
            ],
            [
                -88.00872802734374,
                42.0615286181226
            ],
            [
                -87.82196044921874,
                41.98195261665715
            ],
            [
                -87.61871337890624,
                41.89001042401827
            ],
            [
                -87.6324462890625,
                41.777456667491066
            ],
            [
                -87.5115966796875,
                41.69752591075902
            ],
            [
                -87.48138427734375,
                41.60722821271717
            ],
            [
                -87.25616455078125,
                41.59285100004952
            ],
            [
                -87.01171875,
                41.57641597789266
            ],
            [
                -86.81396484375,
                41.623655390686395
            ],
            [
                -86.5887451171875,
                41.72828028223453
            ],
            [
                -86.4404296875,
                41.75492216766298
            ],
            [
                -86.165771484375,
                41.7180304600481
            ],
            [
                -86.05316162109375,
                41.73852846935917
            ],
            [
                -85.74554443359375,
                41.73647896274239
            ],
            [
                -85.517578125,
                41.756971085614175
            ],
            [
                -85.111083984375,
                41.75492216766298
            ],
            [
                -84.9847412109375,
                41.73852846935917
            ],
            [
                -84.78973388671875,
                41.629814503758624
            ],
            [
                -83.69659423828125,
                41.59490508367679
            ],
            [
                -83.61145019531249,
                41.58668835697237
            ],
            [
                -83.16375732421875,
                41.41595533303718
            ],
            [
                -82.80120849609374,
                41.347948493443546
            ],
            [
                -82.4908447265625,
                41.32732632036622
            ],
            [
                -82.27111816406249,
                41.35619553438905
            ],
            [
                -82.12005615234375,
                41.38917324986403
            ],
            [
                -81.99371337890625,
                41.37474755643594
            ],
            [
                -81.84539794921875,
                41.428312571522916
            ],
            [
                -81.69158935546875,
                41.45919537950706
            ],
            [
                -81.66961669921875,
                41.52708581365465
            ],
            [
                -81.5020751953125,
                41.6010669423553
            ],
            [
                -81.441650390625,
                41.59490508367679
            ],
            [
                -81.02142333984375,
                41.763117447005875
            ],
            [
                -80.76599121093749,
                41.826595373571706
            ],
            [
                -80.1177978515625,
                42.03501434990212
            ],
            [
                -79.43115234375,
                42.41737381352118
            ],
            [
                -79.1400146484375,
                42.53082032025189
            ],
            [
                -78.80767822265625,
                42.783307077249624
            ],
            [
                -78.75823974609375,
                42.95039177450287
            ],
            [
                -78.61541748046875,
                42.9524020856897
            ],
            [
                -78.35723876953124,
                43.014689161895184
            ],
            [
                -77.7886962890625,
                43.038783344984836
            ],
            [
                -77.5634765625,
                43.04881979669318
            ],
            [
                -77.34649658203125,
                42.99058552185121
            ],
            [
                -76.959228515625,
                42.9524020856897
            ],
            [
                -76.68731689453125,
                43.00866413845207
            ],
            [
                -76.53900146484375,
                43.08092540794885
            ],
            [
                -76.2396240234375,
                43.1090040242731
            ],
            [
                -76.1517333984375,
                43.092960677116295
            ],
            [
                -75.7342529296875,
                43.092960677116295
            ],
            [
                -75.60379028320312,
                43.1270477646888
            ],
            [
                -75.29754638671875,
                43.12805003869856
            ],
            [
                -75.26596069335938,
                43.138071875541385
            ],
            [
                -75.06271362304688,
                43.05383740681216
            ],
            [
                -75.00091552734375,
                43.01569327500512
            ],
            [
                -74.81002807617186,
                43.01368503236689
            ],
            [
                -74.6630859375,
                42.98857645832184
            ],
            [
                -74.59716796875,
                42.91017176199848
            ],
            [
                -74.46258544921875,
                42.894076403348976
            ],
            [
                -74.38156127929688,
                42.94637095514085
            ],
            [
                -74.28680419921875,
                42.93129054333758
            ],
            [
                -74.19754028320312,
                42.92827401776912
            ],
            [
                -74.02175903320312,
                42.850799307092515
            ],
            [
                -74.01214599609375,
                42.78532283730215
            ],
            [
                -73.839111328125,
                42.69555799408926
            ],
            [
                -73.84735107421875,
                42.67738750800699
            ],
            [
                -73.78555297851562,
                42.63193804106213
            ],
            [
                -73.78692626953125,
                42.57937729240967
            ],
            [
                -73.78829956054686,
                42.515638518736665
            ],
            [
                -73.66195678710938,
                42.481212777716166
            ],
            [
                -73.6138916015625,
                42.476148570254516
            ],
            [
                -73.55072021484375,
                42.439674178149424
            ],
            [
                -73.54522705078125,
                42.41940144722477
            ],
            [
                -73.46832275390624,
                42.38086519582321
            ],
            [
                -73.39004516601562,
                42.338244963350846
            ],
            [
                -73.34335327148438,
                42.3016903282445
            ],
            [
                -73.1964111328125,
                42.3016903282445
            ],
            [
                -73.13323974609374,
                42.279340930853145
            ],
            [
                -73.11264038085938,
                42.248851700720955
            ],
            [
                -72.99453735351562,
                42.23461834757937
            ],
            [
                -72.89978027343749,
                42.17154633452751
            ],
            [
                -72.67044067382812,
                42.14202329789122
            ],
            [
                -72.44110107421875,
                42.17052852806085
            ],
            [
                -72.37655639648438,
                42.15118709351198
            ],
            [
                -72.30239868164062,
                42.17459965566123
            ],
            [
                -72.19940185546875,
                42.180705855725115
            ],
            [
                -72.11013793945312,
                42.13183974703906
            ],
            [
                -71.91513061523438,
                42.17663512119453
            ],
            [
                -71.74484252929688,
                42.220381783720605
            ],
            [
                -71.60614013671875,
                42.23461834757937
            ],
            [
                -71.40426635742188,
                42.31997030030749
            ],
            [
                -71.35757446289062,
                42.31793945446847
            ],
            [
                -71.26968383789062,
                42.343320316410804
            ],
            [
                -71.13510131835938,
                42.35854391749705
            ],
            [
                -71.12205505371092,
                42.35714857423679
            ],
            [
                -71.10729217529297,
                42.349029598909965
            ],
            [
                -71.07536315917967,
                42.34750717427501
            ],
            [
                -71.05424880981445,
                42.346619076210494
            ],
            [
                -71.04532241821289,
                42.34852212812849
            ],
            [
                -71.03588104248045,
                42.34636533160187
            ],
            [
                -71.03038787841797,
                42.35080571438234
            ],
            [
                -71.02502346038818,
                42.36079542878592
            ],
            [
                -71.02523803710938,
                42.368310452775766
            ],
            [
                -71.02867126464842,
                42.372844399502966
            ],
            [
                -71.02948665618896,
                42.37560265451935
            ],
            [
                -71.02150440216064,
                42.383274404901535
            ]
        ]

    var stepsTaken = @Model?.StepsTaken;

    // Calculate the distance in kilometers between route start/end point.
    var line = turf.lineString(route);
    var lengthMiles = turf.length(line, { units: 'miles' });
    document.getElementById("stats").innerHTML += addCommas(Math.round(lengthMiles)) + " Miles";

    var lengthKilometers = turf.length(line, { units: 'kilometers' });
    document.getElementById("stats").innerHTML += " &#8226; " + addCommas(Math.round(lengthKilometers)) + " Kilometers";

    // sourced from https://www.chparks.com/411/How-To-Measure-Steps
    // 2k miles per step
    var totalStepsUnrounded = lengthMiles * 2000;
    console.log("totalStepsUnrounded: " + totalStepsUnrounded);
    var totalSteps = Math.round(totalStepsUnrounded);
    console.log("totalSteps: " + totalSteps);
    document.getElementById("stats").innerHTML += " &#8226; " + addCommas(totalSteps) + " Steps";
    document.getElementById("stepsInRoute").value = totalSteps;
    document.getElementById("stepsTaken").value = stepsTaken;

    // Calculate the distance traveled.
    var milesFromSteps = stepsTaken / 2000;
    console.log("milesFromSteps: " + milesFromSteps);
    var start = 0;
    var stop = milesFromSteps;
    var routeTraveled = turf.lineSliceAlong(line, start, stop, { units: 'miles' });
    console.log(routeTraveled);

    // Calculate the distance remaining.
    var milesFromSteps = stepsTaken / 2000;
    var start = milesFromSteps;
    var stop = lengthMiles;
    var routeRemaining = turf.lineSliceAlong(line, start, stop, { units: 'miles' });
    console.log(routeTraveled);

    // Get the point for the marker Icon
    var options = { units: 'miles' };
    var along = turf.along(line, milesFromSteps, options);

    // Set the progress bar
    var progressbarWidth = Math.round((stepsTaken / totalSteps) * 100);
    console.log(progressbarWidth);
    document.getElementById("progressbar").style.width = progressbarWidth + "%";
    document.getElementById("progresslabel").innerHTML += "~" + progressbarWidth + "% Complete";

    // Create a GeoJSON source with an empty lineString.
    var geojson = {
        'type': 'FeatureCollection',
        'features': [
            {
                'type': 'Feature',
                'geometry': {
                    'type': 'LineString',
                    'coordinates': [[0, 0]]
                }
            }
        ]
    };

    map.on('load', function () {

        map.addSource('routeTraveled', {
            'type': 'geojson',
            'data': {
                'type': 'Feature',
                'properties': {},
                'geometry': {
                    'type': 'LineString',
                    'coordinates': routeTraveled.geometry.coordinates
                }
            }
        });

        map.addLayer({
            'id': 'routeTraveled',
            'type': 'line',
            'source': 'routeTraveled',
            'layout': {
                'line-join': 'round',
                'line-cap': 'round'
            },
            'paint': {
                'line-color': '#ff0000',
                'line-width': 5,
                'line-opacity': 0.8
            }
        });

        map.addSource('route', {
            'type': 'geojson',
            'data': {
                'type': 'Feature',
                'properties': {},
                'geometry': {
                    'type': 'LineString',
                    'coordinates': routeRemaining.geometry.coordinates
                }
            }
        });

        map.addLayer({
            'id': 'route',
            'type': 'line',
            'source': 'route',
            'layout': {
                'line-join': 'round',
                'line-cap': 'round'
            },
            'paint': {
                'line-color': '#0075ff',
                'line-width': 5,
                'line-opacity': 0.8
            }
        });

        map.loadImage(
            './wagon.png',
            function (error, image) {
                if (error) throw error;
                map.addImage('wagon', image);
                map.addSource('point', {
                    'type': 'geojson',
                    'data': {
                        'type': 'FeatureCollection',
                        'features': [
                            {
                                'type': 'Feature',
                                'geometry': {
                                    'type': 'Point',
                                    'coordinates': along.geometry.coordinates
                                }
                            }
                        ]
                    }
                });
                map.addLayer({
                    'id': 'points',
                    'type': 'symbol',
                    'source': 'point',
                    'layout': {
                        'icon-image': 'wagon',
                        'icon-size': 0.2
                    }
                });
            }
        );
    });
</script>